<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Variable Inspector</title>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
</head>

<body>
    <div id="app">
        <div v-for="variable in variableList">
            {{variable.key}}
        </div>
    </div>
    <script>
        new Vue({
            el: '#app',
            data: {
                variables: {}
            },
            computed: {
                variableList() {
                    return Object.entries(this.variables).map(([key, history]) => ({ key, history }));
                }
            },
            mounted() {
                const app = this;
                window.ipcRenderer.on("all-variables", (variables) => {
                    app.variables = {};
                    for(const variable of variables) {
                        variable.action = "set";
                        app[variable.key] = [variable]
                    }
                });

                window.ipcRenderer.on("variable-set", ({ key, value, ttl }) => {
                    if(app.variables[key]) {
                        app.variables[key].history.unshift({
                            key,
                            value,
                            ttl,
                            action: "set"
                        })
                    } else {
                        app.variables[key] = [{
                            key,
                            value,
                            ttl,
                            action: "set"
                        }];
                    }
                });
            }
        })
    </script>
</body>
</html>